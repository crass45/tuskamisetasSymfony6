{# templates/web/product/partials/_details_panel.html.twig #}
{# Este fichero contiene el contenido de tu antiguo 'productoFichaDerecha2.html.twig', migrado. #}

<div class="product-information"><!--/product-information-->
    <div class="hidden-xs">
        <h1 style="font-size: 28px; margin: 0px;" itemprop="name">{{ modelo.nombre | upper }}</h1>
        <p itemprop="name">
{#            <a style="color: black; font-size: 18px" href="{{ path('app_catalog_listing', {'_locale': app.request.locale, 'slug': modelo.fabricante.nombreUrl}) }}">#}
                <a style="color: black; font-size: 18px" href="#">
                {{ modelo.fabricante.nombre }}
            </a>
        </p>
        {% if modelo.familia %}
            <h2 style="font-size: 14px; margin: 0px;">{{ modelo.familia }}</h2>
        {% endif %}
        <p><b>REF:</b> {{ modelo.referencia }}</p>
    </div>

    <p itemprop="description"><b>{% trans %}Descripción{% endtrans %}: </b>{{ modelo.descripcion | raw }}</p>
    {% if modelo.composicion %}
        <p><b>{% trans %}Composición{% endtrans %}:</b> {{ modelo.composicion | raw }}</p>
    {% endif %}

    {# --- INICIO DE LA CORRECCIÓN --- #}
    {# Volvemos a calcular la condición para saber si estamos en la vista compleja #}
    {% set hasExtraImages = modelo.childImage or (modelo.otherImages and modelo.otherImages|split(',')|filter(img => img is not empty)|length > 0) or (modelo.detailsImages and modelo.detailsImages|split(',')|filter(img => img is not empty)|length > 0) %}

    {% if hasExtraImages %}
        <div class="colores">
            <div style="text-align: center; margin-bottom: 30px">
                {% for productoColor in modelo.getColoresProductos() %}
                    <div class="colorProducto colorProductoPresupuesto {{ productoColor.color.id }}" data-modelo="{{ modelo.id }}" data-color="{{ productoColor.color.id }}" style="display: inline-block; position: relative;">
                        <a data-toggle="tooltip" title="{{ productoColor.color.nombre |upper }}">
                            {% if productoColor.imagen %}
                                <img src="{{ sonata_path(productoColor.imagen, 'mini') }}" data-imagen-grande="{{ sonata_path(productoColor.imagen, 'wide') }}" alt="{{ productoColor.color.nombre }}">
                            {% else %}
                                <div style="width: 40px; height: 40px; background-color: {{ productoColor.color.codigoRGB }}; border: 1px solid #ccc;" data-imagen-grande="{{ productoColor.modelo.urlImage }}"></div>
                            {% endif %}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <p itemprop="offers" itemscope itemtype="http://schema.org/AggregateOffer"><b>{% trans %}Precio{% endtrans %}
            :</b> {% trans %}Desde{% endtrans %} <span
                itemprop="lowPrice"
                content="{{ modelo.getPrecioUnidad(app.user) | number_format(2, '.', ',') }}"> {{ modelo.getPrecioUnidad(app.user) | number_format(2, ',', '.') }}</span>
        <span itemprop="highPrice"
              content="{{ modelo.getPrecioCantidadColor(1, app.user) | number_format(2, '.', ',') }}"></span>€
        <meta itemprop="priceCurrency" content="EUR"/>
        <span itemprop="seller" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TusKamisetas"/>
        </span>
        <meta itemprop="availability" content="InStock"/>
        <meta itemprop="url" content="{{ url('app_product_detail', {'_locale': app.request.locale, 'slug': modelo.nombreUrl}) }}"/>
    </p>

    <p><b>{% trans %}Tallas{% endtrans %}:</b> {{ modelo.getTallasString() }}</p>

    {# ... (Lógica para la ficha técnica y 'Ver medidas') ... #}

    {% if modelo.getTarif() %}
        <p><b>{% trans %}PRECIO POR CANTIDADES{% endtrans %}</b></p>
        {% set incrementos = modelo.getTarif().precios %}
        {% if app.user %}
            {% for grupo in app.user.groups %}
                {% for descuento in grupo.descuentos %}
                    {% if descuento.getTarifaAnterior == modelo.getTarif() %}
                        {% set incrementos = descuento.getTarifa.precios %}
                    {% endif %}
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if modelo.hasColor or modelo.hasBlanco %}
            <div class="table-responsive">
                <table class="table-responsive" style="text-align: center; font-size: 12px;width: 100%; margin-top: 0px">
                    {# ... (Tabla de precios para adultos) ... #}
                </table>
            </div>
        {% endif %}

        {% if modelo.hasBlancoNino or modelo.hasColorNino %}
            <div class="table-responsive">
                <table class="table-responsive" style="text-align: center; font-size: 12px; width: 100%">
                    {# ... (Tabla de precios para niños) ... #}
                </table>
            </div>
        {% endif %}

        {% if modelo.variaPrecioEntreTallas(app.user) %}
            <div style="font-size: 12px">
                Los precios de algunas tallas y/o colores podrían ser distintos a los mostrados en esta tabla.
            </div>
        {% endif %}
    {% endif %}
</div>

