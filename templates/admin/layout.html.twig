{# templates/admin/layout.html.twig #}

{# 1. Herencia (sin cambios) #}
{% extends '@SonataAdmin/standard_layout.html.twig' %}

{# 2. Estilos (sin cambios) #}
{% block stylesheets %}
    {{ parent() }}
    <link rel="shortcut icon" href="{{ asset('icon.png') }}" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ asset('icon.png') }}"> {# Opcional si tienes el PNG #}
{% endblock %}

{# 3. Bloque de contenido de la barra lateral con la ruta final corregida #}
{% block side_bar_after_nav_content %}
    <div style="text-align: left; padding-left: 5px;">
        <p>
            <a href="{{ path('app_home') }}" rel="noreferrer" target="_blank" style="color: #b8c7ce;">
                <i class="fas fa-globe fa-fw"></i> Visitar TusKamisetas.com
            </a>
        </p>

        {% if is_granted('ROLE_SUPER_ADMIN') %}
            <p>
                {# AHORA: Usamos la ruta correcta que me has indicado #}
                <a href="{{ path('app_admin_supplier_order_request') }}" style="color: #b8c7ce;">
                    <i class="fas fa-truck fa-fw"></i> Pedir a proveedor
                </a>
            </p>
        {% endif %}
    </div>
{% endblock %}

{# 4. Javascripts (sin cambios) #}
{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    {# --- INICIO REEMPLAZO TINYMCE POR CKEDITOR --- #}
    {# Cargamos CKEditor 4 Standard desde su CDN oficial #}
    <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Buscamos todos los textareas que tengan la clase 'tinymce'
            // (que es la que usas en PedidoAdmin.php y otros admins)
            const textareas = document.querySelectorAll('textarea.tinymce');

            textareas.forEach(function(textarea) {
                // Verificamos que tenga ID, si no CKEditor puede fallar, se lo generamos
                if (!textarea.getAttribute('id')) {
                    textarea.setAttribute('id', 'ckeditor_' + Math.random().toString(36).substr(2, 9));
                }

                // Reemplazamos el textarea por CKEditor
                CKEDITOR.replace(textarea, {
                    language: 'es',
                    height: 500,
                    // Opcional: Configuración para permitir todo tipo de contenido (evita que CKEditor limpie etiquetas)
                    allowedContent: true,
                    // Opcional: Eliminar la etiqueta <p> automática al escribir
                    enterMode: CKEDITOR.ENTER_BR,
                    versionCheck: false
                });
            });
        });
    </script>

{% endblock %}